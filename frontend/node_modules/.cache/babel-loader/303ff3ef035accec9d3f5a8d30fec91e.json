{"ast":null,"code":"import _toConsumableArray from\"C:/study projects/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/study projects/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from\"react\";import{Redirect,Route,Switch,withRouter}from'react-router-dom';import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import PopupWithForm from\"./PopupWithForm\";import ImagePopup from\"./ImagePopup\";import api from\"../utils/api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import ProtectedRoute from\"./ProtectedRoute\";import Register from\"./Register\";import Login from\"./Login\";import RegisterButton from\"./RegisterButton\";import LoginButton from\"./LoginButton\";import{authorize,checkTokenValidity,register}from\"../utils/authorization\";import AuthorizedHeader from\"./AuthorizedHeader\";import InfoPopup from\"./InfoPopup\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(props){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setEditProfilePopupState=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setAddPlacePopupState=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setEditAvatarPopupState=_React$useState6[1];var _React$useState7=React.useState(true),_React$useState8=_slicedToArray(_React$useState7,2),isInfoPopupOpen=_React$useState8[0],setInfoPopupState=_React$useState8[1];var _React$useState9=React.useState(null),_React$useState10=_slicedToArray(_React$useState9,2),selectedCard=_React$useState10[0],setSelectedCard=_React$useState10[1];var _React$useState11=React.useState([]),_React$useState12=_slicedToArray(_React$useState11,2),cards=_React$useState12[0],setCards=_React$useState12[1];var _React$useState13=React.useState(null),_React$useState14=_slicedToArray(_React$useState13,2),currentUser=_React$useState14[0],setCurrentUser=_React$useState14[1];var _React$useState15=React.useState(null),_React$useState16=_slicedToArray(_React$useState15,2),email=_React$useState16[0],setEmail=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isLoggedIn=_React$useState18[0],setIsLoggedIn=_React$useState18[1];// признак авторизованности пользователя\nvar history=props.history;React.useEffect(function(){Promise.all([api.getInitialCards(),api.getUserInfo()]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),initialCards=_ref2[0],userInfo=_ref2[1];setCurrentUser(userInfo);setCards(initialCards);}).catch(function(err){console.log(err);});},[]);/*React.useEffect(() => {\n        if (isLoggedIn) {\n            history.push(\"/\")\n        }\n    }, [isLoggedIn]);*/React.useEffect(function(){checkToken();},[]);function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});if(!isLiked){// Отправляем запрос в API и получаем обновлённые данные карточки\napi.addLike(card._id).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}else{api.removeLike(card._id).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}}function handleCardDelete(card){api.removeCard(card._id).then(function(){setCards(function(state){return state.filter(function(c){return c._id!==card._id;});});}).catch(function(err){console.log(err);});}function handleEditAvatarClick(){setEditAvatarPopupState(true);}function handleEditProfileClick(){setEditProfilePopupState(true);}function handleAddPlaceClick(){setAddPlacePopupState(true);}function handleCardClick(card){setSelectedCard(card);}function closeAllPopups(){setEditAvatarPopupState(false);setEditProfilePopupState(false);setAddPlacePopupState(false);setSelectedCard(null);}function handleUpdateUser(_ref3){var name=_ref3.name,about=_ref3.about;api.updateUserInfo(name,about).then(function(info){setCurrentUser(info);closeAllPopups();}).catch(function(err){console.log(err);});}function handleUpdateAvatar(_ref4){var url=_ref4.url;api.changeAvatar(url).then(function(info){setCurrentUser(info);closeAllPopups();}).catch(function(err){console.log(err);});}function handleAddPlaceSubmit(_ref5){var name=_ref5.name,url=_ref5.url;api.addCard(name,url).then(function(item){setCards([item].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(err);});}function handleRegister(password,email){register(password,email).then(function(){setIsLoggedIn(true);history.push(\"/\");});}function handleAuthorization(password,email){authorize(password,email).then(function(res){setIsLoggedIn(true);localStorage.setItem('token',res.token);history.push(\"/\");});}function checkToken(){var token=localStorage.getItem('token');if(token){checkTokenValidity(token).then(function(res){setEmail(res.data.email);setIsLoggedIn(true);history.push(\"/\");}).catch(function(){setIsLoggedIn(false);history.push(\"/sign-in\");});}}function handleClick(path){history.push(\"\".concat(path));}function handleLogout(path){handleClick(path);setIsLoggedIn(false);localStorage.removeItem('token');}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsx(\"div\",{className:\"root\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"root__container\",children:[/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsxs(Route,{exact:true,path:\"/sign-up\",children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(RegisterButton,{path:\"/sign-in\",onClick:handleClick}),/*#__PURE__*/_jsx(Register,{onHandleSubmit:handleRegister})]}),/*#__PURE__*/_jsxs(Route,{exact:true,path:\"/sign-in\",children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(LoginButton,{path:\"/sign-up\",onClick:handleClick}),/*#__PURE__*/_jsx(Login,{onHandleSubmit:handleAuthorization}),/*#__PURE__*/_jsx(InfoPopup,{isOpen:true,src:\"../images/ok.svg\"})]}),/*#__PURE__*/_jsxs(ProtectedRoute,{path:\"/\",loggedIn:isLoggedIn,children:[/*#__PURE__*/_jsx(AuthorizedHeader,{email:email,path:\"/sign-in\",onClick:handleLogout}),/*#__PURE__*/_jsx(Main,{onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleCardDelete})]}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",children:isLoggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/sign-in\"})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,submitBtnName:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit,submitBtnName:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C\"}),/*#__PURE__*/_jsx(PopupWithForm,{title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",name:\"are_you-sure\",onClose:closeAllPopups,submitBtnName:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar,submitBtnName:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups})]})})});}export default withRouter(App);","map":{"version":3,"sources":["C:/study projects/react-mesto-auth/src/components/App.js"],"names":["React","Redirect","Route","Switch","withRouter","Header","Main","Footer","PopupWithForm","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ProtectedRoute","Register","Login","RegisterButton","LoginButton","authorize","checkTokenValidity","register","AuthorizedHeader","InfoPopup","App","props","useState","isEditProfilePopupOpen","setEditProfilePopupState","isAddPlacePopupOpen","setAddPlacePopupState","isEditAvatarPopupOpen","setEditAvatarPopupState","isInfoPopupOpen","setInfoPopupState","selectedCard","setSelectedCard","cards","setCards","currentUser","setCurrentUser","email","setEmail","isLoggedIn","setIsLoggedIn","history","useEffect","Promise","all","getInitialCards","getUserInfo","then","initialCards","userInfo","catch","err","console","log","checkToken","handleCardLike","card","isLiked","likes","some","i","_id","addLike","newCard","state","map","c","removeLike","handleCardDelete","removeCard","filter","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","closeAllPopups","handleUpdateUser","name","about","updateUserInfo","info","handleUpdateAvatar","url","changeAvatar","handleAddPlaceSubmit","addCard","item","handleRegister","password","push","handleAuthorization","res","localStorage","setItem","token","getItem","data","handleClick","path","handleLogout","removeItem"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport {Redirect, Route, Switch, withRouter} from 'react-router-dom';\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport api from \"../utils/api\";\nimport {CurrentUserContext} from \"../contexts/CurrentUserContext\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport Register from \"./Register\";\nimport Login from \"./Login\";\nimport RegisterButton from \"./RegisterButton\";\nimport LoginButton from \"./LoginButton\";\nimport {authorize, checkTokenValidity, register} from \"../utils/authorization\";\nimport AuthorizedHeader from \"./AuthorizedHeader\";\nimport InfoPopup from \"./InfoPopup\";\n\nfunction App(props) {\n    const [isEditProfilePopupOpen, setEditProfilePopupState] = React.useState(false);\n    const [isAddPlacePopupOpen, setAddPlacePopupState] = React.useState(false);\n    const [isEditAvatarPopupOpen, setEditAvatarPopupState] = React.useState(false);\n    const [isInfoPopupOpen, setInfoPopupState] = React.useState(true);\n\n    const [selectedCard, setSelectedCard] = React.useState(null);\n    const [cards, setCards] = React.useState([]);\n\n    const [currentUser, setCurrentUser] = React.useState(null);\n    const [email, setEmail] = React.useState(null);\n\n    const [isLoggedIn, setIsLoggedIn] = React.useState(false); // признак авторизованности пользователя\n\n    const {history} = props;\n\n    React.useEffect(() => {\n        Promise.all([api.getInitialCards(), api.getUserInfo()]).then(([initialCards, userInfo]) => {\n            setCurrentUser(userInfo);\n            setCards(initialCards);\n        }).catch((err) => {\n            console.log(err);\n        })\n    }, []);\n\n    /*React.useEffect(() => {\n        if (isLoggedIn) {\n            history.push(\"/\")\n        }\n    }, [isLoggedIn]);*/\n\n    React.useEffect(() => {\n        checkToken();\n    }, []);\n\n    function handleCardLike(card) {\n        const isLiked = card.likes.some(i => i._id === currentUser._id);\n        if (!isLiked) {\n            // Отправляем запрос в API и получаем обновлённые данные карточки\n            api.addLike(card._id).then((newCard) => {\n                setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n            }).catch((err) => {\n                console.log(err);\n            });\n        } else {\n            api.removeLike(card._id).then((newCard) => {\n                setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n            }).catch((err) => {\n                console.log(err);\n            });\n        }\n    }\n\n    function handleCardDelete(card) {\n        api.removeCard(card._id).then(() => {\n            setCards((state) => state.filter((c) => c._id !== card._id));\n        }).catch((err) => {\n            console.log(err);\n        });\n    }\n\n    function handleEditAvatarClick() {\n        setEditAvatarPopupState(true);\n    }\n\n    function handleEditProfileClick() {\n        setEditProfilePopupState(true);\n    }\n\n    function handleAddPlaceClick() {\n        setAddPlacePopupState(true);\n    }\n\n    function handleCardClick(card) {\n        setSelectedCard(card);\n    }\n\n    function closeAllPopups() {\n        setEditAvatarPopupState(false);\n        setEditProfilePopupState(false);\n        setAddPlacePopupState(false);\n        setSelectedCard(null);\n    }\n\n    function handleUpdateUser({name, about}) {\n        api.updateUserInfo(name, about).then((info) => {\n            setCurrentUser(info);\n            closeAllPopups();\n        }).catch((err) => {\n            console.log(err);\n        });\n    }\n\n    function handleUpdateAvatar({url}) {\n        api.changeAvatar(url).then((info) => {\n            setCurrentUser(info);\n            closeAllPopups();\n        }).catch((err) => {\n            console.log(err);\n        })\n    }\n\n    function handleAddPlaceSubmit({name, url}) {\n        api.addCard(name, url).then((item) => {\n            setCards([item, ...cards]);\n            closeAllPopups();\n        }).catch((err) => {\n            console.log(err);\n        })\n    }\n\n    function handleRegister(password, email) {\n        register(password, email).then(() => {\n            setIsLoggedIn(true);\n            history.push(\"/\");\n        });\n    }\n\n    function handleAuthorization(password, email) {\n        authorize(password, email).then((res) => {\n            setIsLoggedIn(true);\n            localStorage.setItem('token', res.token);\n            history.push(\"/\");\n        })\n    }\n\n    function checkToken() {\n        const token = localStorage.getItem('token');\n        if (token) {\n            checkTokenValidity(token).then((res) => {\n                setEmail(res.data.email);\n                setIsLoggedIn(true);\n                history.push(\"/\");\n            }).catch(() => {\n                setIsLoggedIn(false);\n                history.push(\"/sign-in\");\n            })\n        }\n    }\n\n    function handleClick(path) {\n        history.push(`${path}`);\n    }\n\n    function handleLogout(path){\n        handleClick(path);\n        setIsLoggedIn(false);\n        localStorage.removeItem('token');\n    }\n\n    return (\n        <CurrentUserContext.Provider value={currentUser}>\n            <div className=\"root\">\n                <div className=\"root__container\">\n                    <Switch>\n                        <Route exact path=\"/sign-up\">\n                            <Header/>\n                            <RegisterButton path=\"/sign-in\" onClick={handleClick}/>\n                            <Register onHandleSubmit={handleRegister}/>\n                        </Route>\n                        <Route exact path=\"/sign-in\">\n                            <Header/>\n                            <LoginButton path=\"/sign-up\" onClick={handleClick}/>\n                            <Login onHandleSubmit={handleAuthorization}/>\n                            <InfoPopup isOpen={true} src=\"../images/ok.svg\"/>\n                        </Route>\n                        <ProtectedRoute\n                            path=\"/\"\n                            loggedIn={isLoggedIn}>\n                            <AuthorizedHeader email={email} path={\"/sign-in\"} onClick={handleLogout}/>\n                            <Main\n                                onEditProfile={handleEditProfileClick}\n                                onAddPlace={handleAddPlaceClick}\n                                onEditAvatar={handleEditAvatarClick}\n                                onCardClick={handleCardClick}\n                                cards={cards}\n                                onCardLike={handleCardLike}\n                                onCardDelete={handleCardDelete}\n                            />\n                        </ProtectedRoute>\n                        <Route exact path=\"/\">\n                            {isLoggedIn ? <Redirect to=\"/\"/> : <Redirect to=\"/sign-in\"/>}\n                        </Route>\n                    </Switch>\n                    <Footer/>\n                    <EditProfilePopup isOpen={isEditProfilePopupOpen} onClose={closeAllPopups}\n                                      onUpdateUser={handleUpdateUser} submitBtnName=\"Сохранить\"/>\n\n                    <AddPlacePopup isOpen={isAddPlacePopupOpen} onClose={closeAllPopups}\n                                   onAddPlace={handleAddPlaceSubmit} submitBtnName=\"Создать\"/>\n\n                    <PopupWithForm title=\"Вы уверены?\" name=\"are_you-sure\" onClose={closeAllPopups}\n                                   submitBtnName=\"Сохранить\"/>\n\n                    <EditAvatarPopup isOpen={isEditAvatarPopupOpen} onClose={closeAllPopups}\n                                     onUpdateAvatar={handleUpdateAvatar} submitBtnName=\"Сохранить\"/>\n\n                    <ImagePopup card={selectedCard} onClose={closeAllPopups}/>\n                </div>\n            </div>\n        </CurrentUserContext.Provider>\n    );\n}\n\nexport default withRouter(App);\n"]},"metadata":{},"sourceType":"module"}